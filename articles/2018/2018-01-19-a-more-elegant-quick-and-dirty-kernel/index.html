<!doctype html>
<html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content="Hugo 0.147.0">
  <title>A more elegant: Quick and dirty kernel</title><link rel="stylesheet" href="https://mikewebbtech.github.io/mikewebb-tech/css/style.min.21cb2879bdc9736d044cba6728046ef1ed8fe1faf4202b674e79b695f5552edd.css" />
  <link rel="icon" type="image/x-icon"  href="/mikewebb-tech/img/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/mikewebb-tech/img/apple-touch-icon.png" />
 
  <link rel="manifest" href="/mikewebb-tech/img/site.webmanifest" />
</head>
<body>
    <div class="layout">  <aside class="sidebar">
    <div class="logo">
      <img src="/mikewebb-tech/avatar.png" alt="avatar" width="192">
      <p class="byline">
        MIKE WEBB TECH
      </p>
      <p class="byline">
        <a href="https://github.com/mikewebbtech" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-square-github"></i></a>
        <a href="https://www.linkedin.com/in/michael-webb-1a36b8a5/" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-linkedin"></i></a>
      </p>
    </div>
    <nav class="nav">
  <ul>
    
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/" ><i class="fa-solid fa-house"></i> Home</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/articles/" ><i class="fa-solid fa-file-code"></i> Articles</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/categories/" ><i class="fa-solid fa-list"></i> Categories</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/series/" ><i class="fa-solid fa-layer-group"></i> Series</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/tags/" ><i class="fa-solid fa-tags"></i> Tags</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/about/" ><i class="fa-solid fa-circle-info"></i> About</a>
      </li>
    
  </ul>
</nav>
    <div class="nav-bottom">
      <a href="https://mikewebb.tech">
        Designed by Mike Webb 
      </a>
      <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
        &copy; 2025 CC BY-NC 4.0
      </a>
      <p>
      created using
      </p> 
      <a href="https://gohugo.io" target="_blank">
        <img src="/mikewebb-tech/hugo-logo-wide.svg" alt="hugo.io" style="width: 40%">
      </a>
      <br><br>
      Git commit 
      
      
      <br><br>
    </div>
  </aside>
  <header class="header">
    <h1>A more elegant: Quick and dirty kernel</h1>
  </header>
<main class="main">

<article class="post">
  <div class="post-header">
    
    <div class="article-meta">
      <div>
        <i class="fa-solid fa-calendar-days"></i>
        Jan 19, 2018
      </div>
      <div>
        <i class="fa-solid fa-file-lines"></i>
        587 words
      </div>
    </div>
  </div><div class="post-content"><p>As we have seen, the original/traditional/generic way to install new kernels or patch existing kernels is a relatively straight forward affair but requires manual management in regards to downloading the latest source (ftp from the nearest mirror) or stepping through the successive patch versions to get to the lastest kernel release.</p>
<p>Since managing a project as massive as the kernel is beyond the means of manual intervention and control, versioning systems  such as git were born to keep development manageable.</p>
<p>We can employ git to help manage our local kernel versioning, patching</p>
<p>This assumes that the system is ready as a development machine and the following, as a minimum, are installed:</p>
<p>gcc ccache openssl-devel kernel-devel git</p>
<p><strong>STEP ONE: GIT IS ABOUT TREES AND BRANCHES. CHECK IT OUT.</strong></p>
<p>It all starts with the source and kernel.org is your go to trusted site for the latest. Change directories to you $HOME</p>
<pre tabindex="0"><code>$ cd
$ git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
$ cd ~/linux
</code></pre><p>This will take awhile and give you access to the release candidate (.rc) kernels as well.</p>
<p>List the tag names to find the latest kernel version (i.e. the highest number, in this case v4.14 is the newest stable release)</p>
<pre tabindex="0"><code>$ git tag -l | more
</code></pre><p>Checkout the files for the branch, using the tag listed from the last command (i.e v4.14)</p>
<pre tabindex="0"><code>[~/linux]$ git checkout -b custom v4.14
</code></pre><p>This will switch to the new branch called custom, now we are all set to customise our kernel prior to compiling it.</p>
<p><strong>STEP TWO: CUSTOMISE AND COMPILE</strong></p>
<p>Using git to manage changes to our base image is great as it manages a history of our local and upstream merges that we view for information or leverage for roll back if there are any issues.</p>
<p>To apply a patch (in this case the famed add-acs-overrides.patch in my Download directory), simply:</p>
<pre tabindex="0"><code>[~/]$ cd ~/Downloads
[~/Downloads]$ wget https://raw.githubusercontent.com/mooteel/linux-mooteel/master/add-acs-overrides.patch
</code></pre><p>If applying a patch in mail format that you got it from a mailing list, use git am patch-name.eml.  Use git apply patch-name.patch if a standard patch file</p>
<pre tabindex="0"><code>[~/linux]$ git apply ~/Downloads/add-acs-overrides.patch
</code></pre><p>The standard work flow for customising the kernel still apply as well.</p>
<p>To use the existing configuration from the current running kernel, do:</p>
<pre tabindex="0"><code>[~/linux]$ cp /boot/config-`uname -r`* .config
</code></pre><p>To interactively make changes using a menu inerface, do:</p>
<pre tabindex="0"><code>[~/linx]$ make menuconfig
</code></pre><p>Which way you chose, be sure to define CONFIG_LOCALVERSION= to something meaningful as this will be appended to the kernel name and atleast you now which one you booting to at the GRUB menu.</p>
<p>Once you have a .config file you are happy with.  &lsquo;make&rsquo; the kernel.  I use a -j option to speed it up by assigning all my hyperthreads to the job e.g.</p>
<pre tabindex="0"><code>[~/linux]$ make -j8
</code></pre><p>Now make the modules and install everything. On the systems I have used this method on, I&rsquo;ve had success with:
<code>[~/linux]$ sudo make modules_install install</code>
<strong>Clean up</strong></p>
<p>If you want to keep your git branch called custom with the changes that you made but dont want to merge the changes back to the master (I recommend this, keep master pristine) , just stash it with</p>
<pre tabindex="0"><code>$ git stash
$ git checkout master
</code></pre><p>In reality we are usually done with the branch that we were working with, so just delete it with</p>
<pre tabindex="0"><code>$ git branch -D custom
</code></pre><p>&lsquo;-D&rsquo; as the branched hasn&rsquo;t been merged.</p>
<p><strong>STEP THREE: REBOOT AND USE</strong></p>
<p>After doing the normal backups and verifications, reboot and select the new kernel in GRUB menu (identified by your definition in CONFIG_LOCALVERSION= .</p>
<pre tabindex="0"><code>$ sudo reboot
</code></pre><p>Beer and profit.</p>
</div>

  <div class="post-footer"></div></article>
</main>
    </div>
  </body>
</html>
