<!doctype html>
<html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content="Hugo 0.147.3">
  <title>Peer certificate error when S/MIME signing email</title><link rel="stylesheet" href="https://mikewebbtech.github.io/mikewebb-tech/css/style.min.d6d64c8e1e96f8ebc418788afbac553656e25959340157a14110ac051f23ad11.css" />
  <link rel="icon" type="image/x-icon"  href="/mikewebb-tech/img/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/mikewebb-tech/img/apple-touch-icon.png" />
 
  <link rel="manifest" href="/mikewebb-tech/img/site.webmanifest" />
</head>
<body data-theme="dark">
    <div class="layout">  <aside class="sidebar">
    <div class="logo">
      <img src="/mikewebb-tech/avatar.png" alt="avatar" width="192">
      <p class="byline">
        MIKE WEBB TECH
      </p>
      <p class="byline">
        <a href="https://github.com/mikewebbtech" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-square-github"></i></a>
        <a href="https://www.linkedin.com/in/michael-webb-1a36b8a5/" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-linkedin"></i></a>
      </p>
    </div>
    <nav class="nav">
  <ul>
    
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/" ><i class="fa-solid fa-house"></i> Home</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/about/" ><i class="fa-solid fa-circle-info"></i> About</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/articles/" ><i class="fa-solid fa-file-code"></i> Articles</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/categories/" ><i class="fa-solid fa-list"></i> Categories</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/series/" ><i class="fa-solid fa-layer-group"></i> Series</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/mikewebb-tech/tags/" ><i class="fa-solid fa-tags"></i> Tags</a>
      </li>
    
  </ul>
</nav>

    <div class="nav-bottom">
      <a href="https://mikewebb.tech">
        Designed by Mike Webb 
      </a>
      <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
        &copy; 2025 CC BY-NC 4.0
      </a>
      <p>
      created using
      </p> 
      <a href="https://gohugo.io" target="_blank">
        <img src="/mikewebb-tech/hugo-logo-wide.svg" alt="hugo.io" style="width: 40%">
      </a>
      <br><br>
      <br><br>
    </div>
  </aside>
  <header class="header">
    <h1>Peer certificate error when S/MIME signing email</h1>
  </header>
<main class="main">

<article class="post">
  <div class="post-header">
    
    <div class="article-meta">
      <div>
        <i class="fa-solid fa-calendar-days"></i>
        Aug 16, 2017
      </div>
      <div>
        <i class="fa-solid fa-file-lines"></i>
        387 words
      </div>
      <div>
        <i class="fa-solid fa-list"></i>
        <a class="tag" href="/mikewebb-tech/categories/home-lab/">Home Lab</a>
      </div>
      <div>
        <i class="fa-solid fa-tags"></i>
        <a class="tag" href="/mikewebb-tech/tags/linux/">Linux</a>
        <a class="tag" href="/mikewebb-tech/tags/solution/">Solution</a>
        <a class="tag" href="/mikewebb-tech/tags/opensource/">Opensource</a>
        <a class="tag" href="/mikewebb-tech/tags/smime/">Smime</a>
      </div>
    </div>
  </div><div class="post-content"><h4 id="the-problem">THE PROBLEM:</h4>
<p>&ldquo;<em>Peer&rsquo;s certificate issuer has been marked as not trusted by the user. (-8172) - Cannot add MS SMIMEEncKeyPrefs attribute&rdquo;, you may need to select different mail options</em>&quot;</p>
<h4 id="the-scenario">THE SCENARIO:</h4>
<p>Right! so I have had this issue a couple of times.  Well in fact, once a year, every year, when I go through the annual ritual of getting a new personal digital certificate for email signing and encryption.  I&rsquo;ll leave my rant on the whys and hows to another post, but will say for now &ldquo;JUST DO IT&rdquo;.</p>
<p>So, once I&rsquo;ve gone through the sacrificing a goat in the name of my issuing Certificate Authority for a blessed signature file (usually PKCS#7 .p7s) I go through the right of creating the guard-it-with-your-life  PKCS#12 (Public Key Cryptography Standard No. 7) .p12 and public/private cert combos.  Sounds arcane but not as hard as it sounds and with the right OS and browser combo it is nearly automated.</p>
<p>I use my .p12 to move the keys I need for email signing and encryption on to my other computers and devices and into the email applications on them (MacOS, linux, IOS, evolution, thunderbird, outlook etc anything that supports PKCS).  To help with this, I temporarily upload my .p12 file to an online data store that uses end-to-end encryption and is accessible from all my platforms.  Mega is my go to solution&hellip;..screw you dropbox.</p>
<p>I haven&rsquo;t gone to deep into why I get errors sometimes when I first use my new key for signing, but it seems limited to machines where I&rsquo;m using NSS instead of OpenSSL libraries and tools.  These are edge case and I suspect are due to the defaults employed by NSS for trusted peers.  Not sure as the fix is easy and done once a year.</p>
<h4 id="the-fix">THE FIX:</h4>
<p>Install or check if you have the libnss tools package for your distribution.</p>
<p>Using the certutil tool, find the certificate name for the key you are trying to use for S/MIME</p>
<pre tabindex="0"><code>$ certutil -d sql:$HOME/.pki/nssdb -L`
</code></pre><p>Now mark the certificate as a trusted peer with</p>
<pre tabindex="0"><code>$ certutil -d sql:$HOME/.pki/nssdb -M -n &#34;Name of Cert&#34; -t Pu,Pu,Pu
</code></pre><p>In the email application make sure the correct cert is selected for the corresponding email address you are sending as and if all went well, no more error.</p>
<h4 id="the-result">THE RESULT:</h4>
<p><strong>Beer and profit</strong></p>
</div>

  <div class="post-footer"></div></article>
</main>
    </div>
  </body>
</html>
