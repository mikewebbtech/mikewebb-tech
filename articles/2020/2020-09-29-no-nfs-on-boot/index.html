<!doctype html>
<html lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content="Hugo 0.147.3">
  <title>No NFS on boot</title><link rel="stylesheet" href="/css/style.min.dfdc3f0fe7e329e3409aee4e64bafe4056d04c03d5ea494e205915dc063ad9af.css" />
  <link rel="icon" type="image/x-icon"  href="/img/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png" />
 
  <link rel="manifest" href="/img/site.webmanifest" />
</head>
<body data-theme="dark">
    <div class="layout">  <aside class="sidebar">
    <div class="logo">
      <img src="/avatar.png" alt="avatar" width="192">
      <p class="byline">
        MIKE WEBB TECH
      </p>
      <p class="byline">
        <a href="https://github.com/mikewebbtech" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-square-github"></i></a>
        <a href="https://www.linkedin.com/in/michael-webb-1a36b8a5/" target="_blank" rel="noopener noreferrer"><i class="fa-brands fa-linkedin"></i></a>
      </p>
    </div>
    <nav class="nav">
  <ul>
    
    
      
      

      
      
      <li>
        <a href="/" ><i class="fa-solid fa-house"></i> Home</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/about/" ><i class="fa-solid fa-circle-info"></i> About</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/articles/" ><i class="fa-solid fa-file-code"></i> Articles</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/categories/" ><i class="fa-solid fa-list"></i> Categories</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/series/" ><i class="fa-solid fa-layer-group"></i> Series</a>
      </li>
    
      
      

      
      
        
        
          
        
      
      <li>
        <a href="/tags/" ><i class="fa-solid fa-tags"></i> Tags</a>
      </li>
    
  </ul>
</nav>

    <div class="nav-bottom">
      <a href="https://mikewebb.tech">
        Designed by Mike Webb 
      </a>
      <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
        &copy; 2025 CC BY-NC 4.0
      </a>
      <p>
      created using
      </p> 
      <a href="https://gohugo.io" target="_blank">
        <img src="/hugo-logo-wide.svg" alt="hugo.io" style="width: 40%">
      </a>
      <br><br>
      <br><br>
    </div>
  </aside>
  <header class="header">
    <h1>No NFS on boot</h1>
  </header>
<main class="main">

<article class="post">
  <div class="post-header">
    
    <div class="article-meta">
      <div>
        <i class="fa-solid fa-calendar-days"></i>
        Sep 29, 2020
      </div>
      <div>
        <i class="fa-solid fa-file-lines"></i>
        410 words
      </div>
      <div>
        <i class="fa-solid fa-list"></i>
        <a class="tag" href="/categories/home-lab/">Home Lab</a>
        <a class="tag" href="/categories/networking/">Neworking</a>
      </div>
      <div>
        <i class="fa-solid fa-tags"></i>
        <a class="tag" href="/tags/ubuntu/">Ubuntu</a>
        <a class="tag" href="/tags/linux/">Linux</a>
        <a class="tag" href="/tags/networking/">Networking</a>
      </div>
    </div>
  </div><div class="post-content"><p>Issue: NFS mounts in fstab not mounting on boot but working with mount -a command works as expected..</p>
<p>I upgraded to Ubuntu 20.04 an noticed that my NFS (v3 and v4) mounts from my file server weren&rsquo;t populate i.e. they weren&rsquo;t being mount on boot (mount command didn&rsquo;t show the NFS mounts). But when I ran a sudo mount -a command everything mounted as expected and confirmed with the mount command. This led me to conclude that my fstab entries were fine and the issue laid else where. Also I marked this issue as an inconvenience and maybe I should look at autofs in the future.</p>
<p>Roll on Covid-19 and lockdowns, I had some spare time to investigate this (f#%k you 2020) and noticed an error in my logs</p>
<pre tabindex="0"><code> mount.nfs: Network is unreachable 
</code></pre><p>As well some other errors relating to remote-fs-pre.target. Bingo! could this be systemd, A quick google-fu and seeing some others having the same issue and list of possible issues and esoteric fixes etc and calls to just use autofs and so on. I decided to look into it myself.</p>
<pre tabindex="0"><code>systemctl show nfs-client.target 
</code></pre><p>Showed:</p>
<pre tabindex="0"><code>WantedBy=remote-fs.target multi-user.target 
Before=shutdown.target multi-user.target remote-fs-pre.target
</code></pre><pre tabindex="0"><code>systemctl show remote-fs.target
</code></pre><p>Showed:</p>
<pre tabindex="0"><code>WantedBy=multi-user.target
After=remote-fs-pre.target
</code></pre><p>And finally</p>
<pre tabindex="0"><code>systemctl show remote-fs-pre.target
</code></pre><p>Rather then showing what is showed, lets talk about what it didn&rsquo;t show. I all this chain of target stubs, nowhere was there the network-online.target. Which I was expecting to see, but was suspecting was misssing to the log error message of network unreachable.</p>
<p>With out going into the way systemd works, the NFS (network file system) client target was trying do its thing before network-online target had run and brought up the network. Think of it as chain of events that have to happen in an order to work.</p>
<p>My fix: Since the log error points to remote-fs-pre.target was well as the network.client.target and remote-fs.target I lokked in remote-fs-pre.target stub file:</p>
<pre tabindex="0"><code>/lib/systemd/system/remote-fs-pre.target
</code></pre><p>and added at the end the missing (IMHO) lines:</p>
<pre tabindex="0"><code>Wants=network-online.target
After=network-online.target
</code></pre><p>Save the file and reboot&hellip;.YAY. All as it should be and one step closer to universal peace.</p>
<p>I&rsquo;m not sure if this a bug of omission or I initially did something wrong or if my solution will cause other issues elsewhere. But it works and I felt vindicated in spending time in understanding systemd when the distros replaced sysv instead of joining in with the wailing and gnashing of teeth (though I&rsquo;m glade I missed the whole upstart shit show).</p>
<p>As always&hellip;beer and profit.</p>
</div>

  <div class="post-footer"></div></article>
</main>
    </div>
  </body>
</html>
